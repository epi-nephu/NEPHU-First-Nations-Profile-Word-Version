---
title: "NEPHU First Nations Population Profile"
subtitle: "Health Consequences: General Health"
output:
  officedown::rdocx_document: 
    page_size:
      width: 8.27
      length: 11.69
    page_margins:
      bottom: 0.5
      top: 0.5
      right: 0.8
      left: 0.8
      gutter: 0
    reference_docx: Template.docx
    
knit: (function(input, ...) {
  rmarkdown::render(input, output_file = paste0("NEPHU First Nations Profile - ", "10A Consequences General ", format(Sys.Date(), "%Y-%m-%d")), output_dir = "../Output/Dev") })
---

```{r setup, include = FALSE}
#
knitr::opts_chunk$set(echo    = FALSE, 
                      warning = FALSE, 
                      message = FALSE,
                      #
                      fig.align  = "center",
                      fig.width  = 7,
                      fig.height = 3.5,
                      #
                      ft.align = "center",
                      #
                      dpi = 300,
                      #
                      fig.topcaption = TRUE,
                      #
                      cache = FALSE)

if (!require("pacman")) install.packages("pacman")

pacman::p_load(here,
               tidyverse,
               rlang,
               janitor,
               readxl,
               sf,
               flextable,
               colorRamps,
               officer,
               officedown,
               extrafont,
               ggnewscale,
               patchwork)

# Uncomment and run these lines if you get any weird "missing font" errors
#extrafont::font_import()
#extrafont::loadfonts(device = "win")
```


```{r, include = FALSE}
#
source(here::here("Code", "00_Setup.R"))

source(here::here("Code", "Functions", "Data prep", "f_read_natsihs_sex.R"))
source(here::here("Code", "Functions", "Data prep", "f_read_census_lga.R"))
source(here::here("Code", "Functions", "Data prep", "f_wrangle_census_lga.R"))
source(here::here("Code", "Functions", "Data prep", "f_read_census_agesex.R"))
source(here::here("Code", "Functions", "Data prep", "f_wrangle_census_agesex.R"))

source(here::here("Code", "Functions", "Graphs", "f_graph_survey_sex.R"))
source(here::here("Code", "Functions", "Graphs", "f_graph_lga.R"))
source(here::here("Code", "Functions", "Graphs", "f_graph_agesex.R"))
source(here::here("Code", "Functions", "Graphs", "f_graph_expected.R"))

source(here::here("Code", "Functions", "Tables", "f_table_survey_sex.R"))
source(here::here("Code", "Functions", "Tables", "f_table_grouped_lga.R"))
source(here::here("Code", "Functions", "Tables", "f_table_grouped_agesex.R"))
source(here::here("Code", "Functions", "Tables", "f_table_expected.R"))
```

**Table of Contents**

```{r}
#
block_toc(level = 2)
```

\newpage

```{r, include = FALSE}
# Numbering and styling for figures and tables
f_caption_figure <- function(title_text) {
  
  caption <- block_caption(title_text, 
                           style   = "caption", 
                           autonum = run_autonum(seq_id    = "Figure", 
                                                 pre_label = "Figure 10A-"))
  
  return(caption)
  
}

f_caption_table <- function(title_text) {
  
  caption <- block_caption(title_text, 
                           style   = "caption", 
                           autonum = run_autonum(seq_id    = "Table", 
                                                 pre_label = "Table 10A-"))
  
  return(caption)
  
}
```

### What is the general health of Aboriginal and/or Torres Strait Islander people living in the NEPHU catchment?

# Self-Reported Health Status

```{r, include = FALSE}
# ------------------------------------------------------------------------------
# Self-assessed health status
# Data from ABS National Aboriginal and Torres Strait Islander Health Survey
# ------------------------------------------------------------------------------
# Read in NATSIHS data
health_status <- f_read_natsihs_sex("Indicator_Vic_Sex_Health_Status.csv")

# Data wrangling
health_status <- health_status %>% 
  dplyr::rowwise() %>% 
  dplyr::mutate(answered_n = sum(across(excellent_n:poor_n))) %>% 
  dplyr::ungroup() %>% 
  #
  janitor::adorn_totals(fill = "Total") %>% 
  #
  dplyr::rename(verygood_n = very_good_n) %>% 
  #
  dplyr::mutate(across(excellent_n:poor_n,
                       ~ . / answered_n * 100,
                       .names = "{.col}_prop"),
                #
                answered_prop = answered_n / answered_n * 100) %>% 
  #
  dplyr::rename_with(~ stringr::str_replace(., "_n_prop$", "_prop"), ends_with("_n_prop")) %>% 
  #
  dplyr::select(sex,
                starts_with("excellent"),
                starts_with("verygood"),
                starts_with("good"),
                starts_with("fair"),
                starts_with("poor"),
                starts_with("answered"))
```

::: {custom-style="Dotpt"}
- Data for this indicator were obtained from the 2022-23 ABS National Aboriginal and Torres Strait Islander Health Survey.

- Overall, 33% of Aboriginal and/or Torres Strait Islander survey respondents aged 15 years and over living in Greater Melbourne reported that they had an excellent or very good level of health. This equates to approximately 8,800 Aboriginal and/or Torres Strait Islander people.

- Males were more likely to report an excellent level of health than females (18% vs. 6%), while females were more likely to report a poor level of health than males (10% vs. 1.4%).
:::

```{r}
# Figure 10A-1
f_caption_figure("(A) Estimated number of people and (B) percentage of survey respondents aged 15 years and over who identified as Aboriginal and/or Torres Strait Islander in each health status category, Greater Melbourne, by sex, 2022-2023")

figure_number <- health_status %>%
  f_graph_survey_sex(plot_tag   = "A",
                     x_levels   = c("excellent_n", "verygood_n", "good_n", "fair_n", "poor_n"),
                     x_labels   = c("Excellent", "Very\ngood", "Good", "Fair", "Poor"),
                     y_variable = n,
                     y_max      = NA,
                     y_breaks   = 1000,
                     y_expand   = 100,
                     y_title    = "Estimated number of people")

figure_percent <- health_status %>%
  f_graph_survey_sex(plot_tag   = "B",
                     x_levels   = c("excellent_prop", "verygood_prop", "good_prop", "fair_prop", "poor_prop"),
                     x_labels   = c("Excellent", "Very\ngood", "Good", "Fair", "Poor"),
                     y_variable = prop,
                     y_max      = 100,
                     y_breaks   = 10,
                     y_expand   = 1,
                     y_title    = "Percentage of survey respondents")

figure_number + figure_percent + 
  plot_layout(guides = "collect") & theme(legend.position = "bottom")
```

#### Data notes:
 
::: {custom-style="Footnotes"}
`r knitr::asis_output(note_data_natsihs)`

`r knitr::asis_output(note_caveat_underidentification)`

`r knitr::asis_output(note_caveat_survey_estimate)`

`r knitr::asis_output(note_caveat_unknown_survey)`
:::

\newpage

```{r}
# Table 10A-1
f_caption_table("Self-reported health status for survey respondents aged 15 years and over who identified as Aboriginal and/or Torres Strait Islander, Greater Melbourne, by sex, 2022-2023")

x_labels <- c("excellent" = "Excellent",
              "verygood"  = "Very good",
              "good"      = "Good",
              "fair"      = "Fair",
              "poor"      = "Poor",
              "answered"  = "Total")

health_status %>% 
  f_table_survey_sex(x_labels       = x_labels,
                     variable_label = "Health status",
                     total_row      = 6)
```

#### Data notes:
 
::: {custom-style="Footnotes"}
`r knitr::asis_output(note_data_natsihs)`

`r knitr::asis_output(note_caveat_underidentification)`

`r knitr::asis_output(note_caveat_survey_estimate)`

`r knitr::asis_output(note_caveat_unknown_survey)`
:::

\newpage

# Any Long-Term Health Condition

```{r}
# ------------------------------------------------------------------------------
# Any long-term health condition, by LGA
# Data from ABS Census using TableBuilderPro
# ------------------------------------------------------------------------------
# Read in Census data
health_any_lga <- f_read_census_lga("Aboriginal_Health_Any_LGA.csv",
                                    variable = "any_condition") %>% 
  #
  dplyr::filter(any_condition != "Not stated")

# Data wrangling
health_any_lga <- health_any_lga %>%
  #
  dplyr::mutate(any_condition = dplyr::case_when(
    any_condition == "Has one or more long-term health condition(s)" ~ "yes",
    TRUE ~ "no")) %>% 
  #
  f_wrangle_census_lga(variable = any_condition,
                       level    = "person",
                       dichot   = "yes")

# ------------------------------------------------------------------------------
# Any long-term health condition, by age and sex
# Data from ABS Census using TableBuilderPro
# ------------------------------------------------------------------------------
# Read in Census data
health_any_agesex <- f_read_census_agesex("Aboriginal_Health_Any_AgeSex.csv",
                                          variable = "any_condition") %>% 
  #
  dplyr::filter(any_condition != "Not stated")

# Data wrangling
health_any_agesex <- health_any_agesex %>% 
  #
  dplyr::mutate(any_condition = dplyr::case_when(
    any_condition == "Has one or more long-term health condition(s)" ~ "yes",
    TRUE ~ "no")) %>%  
  #
  f_wrangle_census_agesex(variable = any_condition,
                          dichot   = "yes")
```


```{r, include = FALSE}
#
results <- list()
data    <- health_any_lga

results$rank_n <- data %>% 
  dplyr::filter(lga_name %in% nephu_lga) %>% 
  dplyr::arrange(desc(aboriginal_n)) %>% 
  dplyr::select(lga_name,
                aboriginal_n)

results$rank_prop <- data %>% 
  dplyr::filter(lga_name %in% nephu_lga) %>% 
  dplyr::arrange(desc(aboriginal_prop)) %>% 
  dplyr::select(lga_name,
                aboriginal_prop)

results$rank_diff <- data %>% 
  dplyr::filter(lga_name %in% nephu_lga) %>% 
  dplyr::arrange(desc(aboriginal_difference)) %>% 
  dplyr::select(lga_name,
                aboriginal_difference)
```

::: {custom-style="Dotpt"}
- Data for this indicator were obtained from the ABS Census 2021.

- Overall, 43% (n = 4,850) of people living in the NEPHU catchment who identified as Aboriginal and/or Torres Strait Islander in the Census are living with one or more long-term health conditions. This is higher than for non-Indigenous people living in the NEPHU catchment (33%).

- The number of people living in different LGAs within the NEPHU catchment who identified as Aboriginal and/or Torres Strait Islander in the Census who are living with one or more long-term health conditions ranged from 850 (Whittlesea LGA) to 90 (Manningham LGA).

- The gap between Aboriginal and/or Torres Strait Islander and non-Indigenous people was biggest for Whittlesea and Hume LGAs.

- The percentage of people living in different LGAs within the NEPHU catchment who identified as Aboriginal and/or Torres Strait Islander in the Census who are living with one or more long-term health conditions ranged from 47% (Maroondah LGA) to 32% (Manningham LGA).

- The percentage of people living in the NEPHU catchment who are living with one or more long-term health conditions increased with increasing age for both males and females. However, the number of people living with one or more long-term health conditions was higher in younger people for both males and females.
:::

\newpage

```{r}
# Figure 10A-2
f_caption_figure("(A) Number and (B) percentage of people who identified as Aboriginal and/or Torres Strait Islander and who are living with one or more long-term health conditions, NEPHU catchment, by LGA, 2021")

figure_number <- health_any_lga %>% 
  dplyr::filter(lga_name %in% nephu_lga) %>% 
  #
  f_graph_lga(y_variable = aboriginal_n,
              y_max      = NA,
              y_breaks   = 100,
              y_expand   = 60,
              y_title    = "Number of people",
              plot_tag   = "A")

figure_percent <- health_any_lga %>% 
  dplyr::filter(lga_name %in% nephu_lga) %>% 
  #
  f_graph_lga(y_variable = aboriginal_prop,
              y_max      = 100,
              y_breaks   = 10,
              y_expand   = 1,
              y_title    = "Percentage of people",
              plot_tag   = "B")

figure_number + figure_percent
```

#### Data notes:
 
::: {custom-style="Footnotes"}
`r knitr::asis_output(note_data_census)`

`r knitr::asis_output(note_caveat_underidentification)`

- The long-term health conditions included in this indicator are: arthritis, asthma, cancer (including remission), dementia (including Alzheimer's), diabetes (excluding gestational diabetes), heart disease (including heart attack and angina), kidney disease, lung conditions (including chronic obstructive pulmonary disease and emphysema), mental health conditions (including depression and anxiety), and stroke.

- People were classified as living with a long-term health condition if they have ever been told by a doctor or nurse that they have one or more of these conditions.
:::

\newpage

```{r}
# Figure 10A-3
f_caption_figure("Observed vs. expected number of Aboriginal and/or Torres Strait Islander people who are living with one or more long-term health conditions, NEPHU catchment, by LGA, 2021")

health_any_lga %>% 
  dplyr::filter(lga_name %in% nephu_lga) %>% 
  #
  f_graph_expected(variable = lga_name,
                   y_breaks = 100,
                   y_expand = 60)
```

#### Data notes:
 
::: {custom-style="Footnotes"}
`r knitr::asis_output(note_data_census)`

`r knitr::asis_output(note_caveat_underidentification)`

- The long-term health conditions included in this indicator are: arthritis, asthma, cancer (including remission), dementia (including Alzheimer's), diabetes (excluding gestational diabetes), heart disease (including heart attack and angina), kidney disease, lung conditions (including chronic obstructive pulmonary disease and emphysema), mental health conditions (including depression and anxiety), and stroke.

- People were classified as living with a long-term health condition if they have ever been told by a doctor or nurse that they have one or more of these conditions.
:::

\newpage

```{r}
# Table 10A-2
f_caption_table("Observed vs. expected number of Aboriginal and/or Torres Strait Islander people who are living with one or more long-term health conditions, NEPHU catchment, by LGA, 2021")

health_any_lga %>% 
  dplyr::filter(lga_name %in% c(nephu_lga, "NEPHU")) %>%
  #
  f_table_expected(variable       = lga_name,
                   variable_label = "LGA",
                   group_label    = " ",
                   total_row      = 13)
```

#### Data notes:
 
::: {custom-style="Footnotes"}
`r knitr::asis_output(note_data_census)`

`r knitr::asis_output(note_caveat_underidentification)`

- The long-term health conditions included in this indicator are: arthritis, asthma, cancer (including remission), dementia (including Alzheimer's), diabetes (excluding gestational diabetes), heart disease (including heart attack and angina), kidney disease, lung conditions (including chronic obstructive pulmonary disease and emphysema), mental health conditions (including depression and anxiety), and stroke.

- People were classified as living with a long-term health condition if they have ever been told by a doctor or nurse that they have one or more of these conditions.
:::

\newpage

```{r}
# Figure 10A-4
f_caption_figure("(A) Number and (B) percentage of people who identified as Aboriginal and/or Torres Strait Islander and who are living with one or more long-term health conditions, NEPHU catchment, by age and sex, 2021")

figure_female_number <- health_any_agesex %>%
  f_graph_agesex(sex        = "Female",
                 y_variable = aboriginal_n,
                 y_max      = 550,
                 y_breaks   = 50,
                 y_expand   = 10,
                 y_title    = "Number of females",
                 plot_title = "Females",
                 plot_tag   = "A")

figure_female_percent <- health_any_agesex %>%
  f_graph_agesex(sex        = "Female",
                 y_variable = aboriginal_prop,
                 y_max      = 100,
                 y_breaks   = 10,
                 y_expand   = 1,
                 y_title    = "Percentage of females",
                 plot_title = " ",
                 plot_tag   = "B")

figure_male_number <- health_any_agesex %>%
  f_graph_agesex(sex        = "Male",
                 y_variable = aboriginal_n,
                 y_max      = 550,
                 y_breaks   = 50,
                 y_expand   = 10,
                 y_title    = "Number of males",
                 plot_title = "Males",
                 plot_tag   = "A")

figure_male_percent <- health_any_agesex %>%
  f_graph_agesex(sex        = "Male",
                 y_variable = aboriginal_prop,
                 y_max      = 100,
                 y_breaks   = 10,
                 y_expand   = 1,
                 y_title    = "Percentage of males",
                 plot_title = " ",
                 plot_tag   = "B")

figure_female_number + figure_female_percent
figure_male_number + figure_male_percent
```

#### Data notes:
 
::: {custom-style="Footnotes"}
`r knitr::asis_output(note_data_census)`

`r knitr::asis_output(note_caveat_underidentification)`

`r knitr::asis_output(note_caveat_unknown_agesex)`

- The long-term health conditions included in this indicator are: arthritis, asthma, cancer (including remission), dementia (including Alzheimer's), diabetes (excluding gestational diabetes), heart disease (including heart attack and angina), kidney disease, lung conditions (including chronic obstructive pulmonary disease and emphysema), mental health conditions (including depression and anxiety), and stroke.

- People were classified as living with a long-term health condition if they have ever been told by a doctor or nurse that they have one or more of these conditions.
:::

\newpage

```{r}
# Figure 10A-5
f_caption_figure("Observed vs. expected number of Aboriginal and/or Torres Strait Islander people who are living with one or more long-term health conditions, NEPHU catchment, by age and sex, 2021") 

health_any_agesex %>%  
  dplyr::filter(age_group %in% age_group_lvl) %>%  
  # 
  dplyr::mutate(age_group = factor(age_group, levels = age_group_lvl)) %>% 
  #
  f_graph_expected(variable = age_group, 
                   y_breaks = 50, 
                   y_expand = 20) +
  #
  facet_wrap(~sex,
             axes = "all")
```

#### Data notes:
 
::: {custom-style="Footnotes"}
`r knitr::asis_output(note_data_census)`

`r knitr::asis_output(note_caveat_underidentification)`

`r knitr::asis_output(note_caveat_unknown_agesex)`

- The long-term health conditions included in this indicator are: arthritis, asthma, cancer (including remission), dementia (including Alzheimer's), diabetes (excluding gestational diabetes), heart disease (including heart attack and angina), kidney disease, lung conditions (including chronic obstructive pulmonary disease and emphysema), mental health conditions (including depression and anxiety), and stroke.

- People were classified as living with a long-term health condition if they have ever been told by a doctor or nurse that they have one or more of these conditions.
:::

\newpage

```{r}
# Table 10A-3
f_caption_table("Observed vs. expected number of Aboriginal and/or Torres Strait Islander people who are living with one or more long-term health conditions, NEPHU catchment, by age and sex, 2021") 

health_any_agesex %>% 
  dplyr::filter(sex == "Female") %>%  
  # 
  f_table_expected(variable       = age_group,
                   variable_label = "Age group",
                   group_label    = "Females",
                   total_row      = 12)
  
health_any_agesex %>% 
  dplyr::filter(sex == "Male") %>%  
  # 
  f_table_expected(variable       = age_group,
                   variable_label = "Age group",
                   group_label    = "Males",
                   total_row      = 12)
```

#### Data notes:
 
::: {custom-style="Footnotes"}
`r knitr::asis_output(note_data_census)`

`r knitr::asis_output(note_caveat_underidentification)`

`r knitr::asis_output(note_caveat_unknown_agesex)`

- The long-term health conditions included in this indicator are: arthritis, asthma, cancer (including remission), dementia (including Alzheimer's), diabetes (excluding gestational diabetes), heart disease (including heart attack and angina), kidney disease, lung conditions (including chronic obstructive pulmonary disease and emphysema), mental health conditions (including depression and anxiety), and stroke.

- People were classified as living with a long-term health condition if they have ever been told by a doctor or nurse that they have one or more of these conditions.
:::

